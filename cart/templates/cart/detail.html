{% extends "main/base.html" %}
{% load static %}
{% block title %}Cart{% endblock title %}

{% block content %}
    <section class="cart py-4">
        <div class="container">
            <!-- Заголовок -->
            <div class="cart-header text-center mb-5">
                <h1 class="fw-bold mb-3">Shopping Cart</h1>
                <p class="text-muted">Review your selected items</p>
            </div>

            <!-- Карточки товаров -->
            <div class="cart-cards">
                {% for item in cart %}
                    {% with product=item.product %}
                        <div class="cart-card card mb-4 shadow-sm border-0">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <!-- Изображение -->
                                    <div class="col-md-2 text-center">
                                        <img src="{% if product.image %}{{product.image.url}}{% else %}{% static 'img/no-image.jpg' %}{% endif %}" 
                                             alt="{{ product.name }}" 
                                             class="cart-card-img img-fluid rounded"
                                             style="max-height: 100px; object-fit: cover;">
                                    </div>
                                    
                                    <!-- Информация -->
                                    <div class="col-md-4">
                                        <div class="cart-card-info">
                                            <h5 class="card-title fw-bold mb-2">{{ product.name }}</h5>
                                            <p class="text-muted mb-1 small">Category: {{ product.category }}</p>
                                            <p class="mb-0"><strong>Quantity:</strong> {{ item.quantity }}</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Цена -->
                                    <div class="col-md-3">
                                        <div class="cart-card-price text-center">
                                            {% if product.discount %}
                                            <div class="cart-discount">
                                                <p class='line text-decoration-line-through mb-1 text-muted'>${{ product.price }}</p> 
                                                <p class='mb-0 fw-bold fs-5 text-success'>${{ product.sell_price }}</p> 
                                            </div>
                                            {% else %}
                                                <p class="price mb-0 fw-bold fs-5">${{ product.price }}</p> 
                                            {% endif %}
                                            <p class="item-total mt-2 mb-0"><strong>Total: ${{ item.total_price }}</strong></p>
                                        </div>
                                    </div>
                                    
                                    <!-- Кнопка удаления -->
                                    <div class="col-md-3 text-center">
                                        {% if product.id %}
                                        <form action="{% url 'cart:remove' product.id %}" method='post' class="d-inline">
                                            {% csrf_token %}
                                            <button type="submit" class="remove-btn btn btn-outline-danger btn-sm">
                                                Remove
                                            </button>
                                        </form>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endwith %}
                {% empty %}
                    <div class="empty-cart text-center py-5">
                        <div class="mb-4">
                            <i class="fas fa-shopping-cart fa-3x text-muted"></i>
                        </div>
                        <h3 class="text-muted mb-3">Your cart is empty</h3>
                        <a href="/shop" class='cart-btn btn btn-primary'>Start Shopping</a>
                    </div>
                {% endfor %}
            </div>

            <!-- Итоги и кнопки -->
            {% if cart %}
            <div class="row mt-5">
                <div class="col-md-8"></div>
                <div class="col-md-4">
                    <div class="total-card card border-0 bg-light">
                        <div class="card-body">
                            <h5 class="card-title fw-bold mb-3">Order Summary</h5>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Items ({{ cart|length }}):</span>
                                <span class="fw-bold">${{ cart.get_total_price }}</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span>Shipping:</span>
                                <span class="text-success">FREE</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between mb-4">
                                <span class="h5 fw-bold">Total:</span>
                                <span class="h5 fw-bold text-primary">${{ cart.get_total_price }}</span>
                            </div>
                            
                            <div class="cart-buttons d-flex flex-column gap-2">
                                <a href="/shop" class='cart-btn btn btn-outline-secondary'>Continue Shopping</a>
                                {% with cart_quantity=cart|length %}
                                    {% if cart_quantity > 0 %}
                                        <a href="#" class='cart-btn btn btn-primary'>Proceed to Checkout</a>
                                    {% endif %}
                                {% endwith %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </section>
{% endblock content %}